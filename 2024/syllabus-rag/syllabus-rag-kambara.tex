\section{探索方法の基本情報と目的}
今回は埋め込みベクトル用いる方法と、単語出現頻度を用いる手法 の２つの探索手法を実験した。

\subsection{埋め込みベクトルによる方法}
この手法は、文書を多次元のベクトル空間上のベクトルとして数値表現したデータを用いて、ベクトル間の距離や類似度によって文書を検索する。 \par
今回は \texttt{HuggingFaceEmbeddings} を用い埋め込みを行っている。埋め込みの前処理と計算はすでにしていただいたデータを用いて、ここではその後の検索手法について実験している。具体的には、\texttt{langchain} の \texttt{vectorstore} の \texttt{as\_retriever} メソッドに備え付けられているコサイン類似度 (similarity) による検索と、Maximal Marginal Relevance (MMR) による検索を実験した。 \par

\subsection{単語出現頻度に基づいた検索手法}
文書を単語分割したデータを用いて、単語の出現頻度に基づいた \texttt{BM25} という手法を実験した。 \par
文書の単語分割には、Pythonのライブラリ \texttt{rank\_bm25} に標準で使用されている \texttt{split()} 関数が日本語に対応していないため、Pythonの日本語形態素解析エンジンである \texttt{janome} を用いている。 \par

\section{埋め込みベクトル探索方法の実験}
\subsection{手法}
チャンク分けの仕方が異なるデータセット３つに対して、コサイン類似度とmmrの探索手法をいくつかのクエリに対して試す
\begin{itemize}
 \item data1
 \item data2
 \item data3
\end{itemize}

\subsection{コサイン類似度(similarity)}
コサイン類似度とは、２つのベクトルがどの程度似ているか表す尺度である。２つのベクトルの内積を２つのベクトルの大きさで割ることで得られる。

\subsection{MMR(周辺関連性最大化:Maximal marginal relevance)}
mmrとは、選択される文書の多様性を広げる検索手法である。クエリーに関連性を持ち、かつ、以前に選択された文書との類似が最小である場合に周辺関連性(marginal relevance)は高くなる。\par
ここでいう周辺関連性とは、関連性と新規性を独立して計測し、線形結合した関連新規性（relevance novelty）という新たな視点を反映した尺度である。潜在的に優れた文書であるが、ユーザーとクエリの関連性という基準だけでは埋もれてしまう文書を見つけるためにある。\\

\subsection{結果のまとめ}

\begin{itemize}
  \item 出力の厳密性は、similarityがよく反映する。キーワードを外さず同じような授業を出すという点でdate3のsimilarityは厳密性が一番高いように思われる。
  \item 多様性を求め、キーワードでは見つからないような授業を探すという基準では、やはりmmrがうまくいく。data1-3のmmrの結果は特筆して変わることはないように思われる。
\end{itemize}




\begin{table}[h!]
    \centering
    \begin{tabular}{|p{4cm}|p{6cm}|p{6cm}|}
        \hline
        質問/応答 & similarity & mmr \\ \hline
        \textbf{電気回路}を学べる科目はなんですか？ & 電気・電子工学電気電子回路電気電子回路演習電気電子回路入門 & 電気・電子工学電磁気学B電気電子回路真空電子工学 \\ \hline
        \textbf{機械学習}を学べる授業は何ですか？ & 機械システム学セミナー（機）パターン認識と機械学習機械学習学術連携共同：数理科学の研究フロンティア & 機械システム学セミナー（機）学術連携共同：数理科学の研究フロンティアパターン認識と機械学習 ILASセミナー ：ロボットとの未来を考える \\ \hline
        脳神経について学べる科目\textbf{を教えてください} & 神経科学の基礎記憶機能論神経心理学 I （神経・生理心理学）神経心理学Ｉ & 神経科学の基礎生物科学課題研究19神経生理学基礎演習：神経心理学 \\ \hline
        脳神経について学べる科目\textbf{は何ですか？} & 神経科学の基礎物科学課題研究19。記憶神経科学ゼミＢ記憶神経科学ゼミA & 神経科学の基礎生物科学課題研究19。ILASセミナー ：霊長類脳神経科学トレーニングコース。神経生理学 \\ \hline
        \textbf{神経科学}について学べる科目はなんですか？ & 生物科学課題研究19神経科学の基礎神経生理学I神経生理学 & 生物科学課題研究19神経科学の基礎神経生理学生物科学特別講義2 \\ \hline
        日本文学に関する授業は何がありますか？ & 日本語学・日本文学演習IIB日本語学・日本文学演習IIA日本語学・日本文学演習IV 国語国文学II & 日本語学・日本文学演習IIB日本語学・日本文学演習IV英米文芸表象論演習B日本史学(特殊講義 \\ \hline
        日本文学を学べる授業は何がありますか？ & 日本語学・日本文学演習IIB日本語学・日本文学演習IIA国語学国文学(演習)日本語学・日本文学演習IIIB & 日本語学・日本文学演習IIB日本語学・日本文学演習IV 英米文芸表象論演習B日本の歴史と文化 \\ \hline
        心理学\textbf{の入門科目}は何がありますか？ & 心理学（実習IA）(心理学実験)心理学概論心理学概論心理学概論 & 心理学（実習IA）(心理学実験)心理学概論言語科学入門（認知情報学系入門科目社会心理学（社会・集団・家族心理学） \\ \hline
        ビジネス\textbf{関連の授業}は何がありますか？ & 企業分析商法（総則・商行為）ビジネスエシックス商法（会社 & 企業分析商法（総則・商行為） ビジネスエシックスアントレプレナーシップ特論 \\ \hline
        生物学の\textbf{実験を含む}授業は何ですか？ & 生物学実習Ｉ ［基礎コース］生物学実習Ｉ ［基礎コース］ 生物学実習Ｉ ［基礎コース 生物学実習Ｉ ［基礎コース］ & 生物学実習Ｉ ［基礎コース］生物科学課題研究19。分子細胞生物学演習生物科学課題研究22 \\ \hline
        環境問題について学べる授業\textbf{を探しています。} & 環境学国際環境政治学 基礎地球科学B （地球システムと環境）演習(4回生)テーマ：エネルギー & 環境学 演習(4回生)地球生存リスク特論環境法 \\ \hline
        環境問題について学べる授業は何ですか？ & 環境学環境経済論演習(3回生)環境問題に関する経済学的研究演習(4回生)テーマ:環境とエネルギーの経済学 & 環境学 演習(3回生演習(4回生)大気・地球環境工学 \\ \hline
    \end{tabular}
    \caption{data1の質問応答表}
\end{table}




\begin{table}[h!]
    \centering
    \begin{tabular}{|p{5cm}|p{5cm}|p{5cm}|}
        \hline
        data2の質問応答表 & similarity & mmr \\ \hline
        電気回路を学べる科目はなんですか？ & 電気・電子工学電気電子回路電気電子回路入門電気回路 & 電気・電子工学電気電子回路電気回路基礎論 \\ \hline
        機械学習を学べる授業は何ですか？ & 機械学習パターン認識と機械学習データ分析演習Ｉ人工知能 & 機械学習機械製作実習（機）データ分析演習Ｉ機械学習 \\ \hline
        脳神経について学べる科目を教えてください & 神経科学の基礎心理学(特殊講義A)（神経・生理心理学）神経心理学 I （神経・生理心理学）神経心理学Ｉ & 神経科学の基礎ILASセミナー ：神経心理学神経生理学の基礎 −生体情報論−霊長類学入門Ｉ \\ \hline
        脳神経について学べる科目は何ですか？ & 神経科学の基礎神経生理学の基礎 −生体情報論−神経科学の基礎記憶神経科学ゼミＢ & 神経科学の基礎神経生物学記憶神経科学ゼミA神経生理学の基礎 −生体情報論− \\ \hline
        神経科学について学べる科目はなんですか？ & 神経科学の基礎 神経科学の基礎神経生物学神経生理学の基礎 −生体情報論 & 神経科学の基礎神経生理学神経生物学神経生物学の \\ \hline
        日本文学に関する授業は何がありますか？ & 日本の歴史と文化 日本語学・日本文学演習IV A日本語学・日本文学演習IV Bメディア文化学(特殊講義) & 日本の歴史と文化言学Ｉ基礎演習：日本近代文学日本語学・日本文学IIIA \\ \hline
        日本文学を学べる授業は何がありますか？ & 基礎演習：日本近代文学基礎演習：日本近代文学日本近代文学II日本近代文学II & 基礎演習：日本近代文学日本語学・日本文学演習IIIB日本語学・日本文学演習IV A日本語学・日本文学IIIA \\ \hline
        心理学の入門科目は何がありますか？ & 心理学概論心理学概論系共通科目(心理学)(講義Ｉ)基礎演習：社会心理学 & 心理学概論ILASセミナー ：社会心理学心理学(演習)（心理演習）基礎演習：社会心理学 \\ \hline
        ビジネス関連の授業は何がありますか？ & 商法（総則・商行為）商法（会社）商法（会社）【旧商法第二部】 & 商法（総則・商行為）ビジネスのための情報システムAI技術利活用実践 ビジネスエシックス \\ \hline
        生物学の実験を含む授業は何ですか？ & 細胞と分子の基礎生物学実験実験動物学生物学実習Ｉ ［基礎コース生物学実習Ｉ ［基礎コース］ & 細胞と分子の基礎生物学実験生物・生命科学入門 実験動物学生物学実習Ｂ \\ \hline
        環境問題について学べる授業を探しています。 & 環境学環境学統合科学 ：持続可能な地球社会をめざして環境動態学 & 環境学演習(3回生環境と法自然と環境の化学 \\ \hline
        環境問題について学べる授業は何ですか？ & 環境学 環境学 環境と法 環境と法 & 環境法 森林環境学 \\ \hline
    \end{tabular}
    \caption{data2の質問応答表}
\end{table}

\begin{table}[h!]
    \centering
    \begin{tabular}{|p{5cm}|p{5cm}|p{5cm}|}
        \hline
        data3 の質問応答表 & similarity & mmr \\ \hline
        電気回路を学べる科目はなんですか？ & 電気回路基礎論電気回路電気・電子工学電気電子回路入門 & 電気回路基礎論電気電子回路電気・電子工学電気回路 \\ \hline
        機械学習を学べる授業は何ですか？ & 機械学習機械学習パターン認識と機械学習パターン認識と機械学習 & 機械学習機械製作実習（機）パターン認識と機械学習機械システム学セミナー（機） \\ \hline
        脳神経について学べる科目を教えてください & 神経科学の基礎神経科学の基礎心理学(特殊講義B)（神経・生理心理学）神経生理学の基礎 −生体情報論− & 神経科学の基礎心理学(特殊講義B)（神経・生理心理学）神経生理学の基礎 −生体情報論−系共通科目(心理学)(講義Kc)（知覚・認知心理学） \\ \hline
        脳神経について学べる科目は何ですか？ & 神経科学の基礎神経科学の基礎神経科学の基礎 神経生理学の基礎 −生体情報論− & 神経科学の基礎神経生物学記憶神経科学ゼミA神経生理学の基礎 −生体情報論− \\ \hline
        神経科学について学べる科目はなんですか？ & 神経科学の基礎神経科学の基礎神経科学の基礎 神経科学の基礎 & 神経科学の基礎神経生物学神経生理学I記憶神経科学ゼミA \\ \hline
        日本文学に関する授業は何がありますか？ & 日本語学・日本文学演習IIB日本語学・日本文学演習IV B日本語学・日本文学演習IIB日本語学・日本文学演習IV A & 日本語学・日本文学演習IIB日本語学・日本文学演習IV B日本の歴史と文化 日本語学・日本文学演習IV B \\ \hline
        日本文学を学べる授業は何がありますか？ & 日本語学・日本文学演習IIB日本語学・日本文学演習IIB日本語学・日本文学演習IIA日本語学・日本文学演習IV B & 日本語学・日本文学演習IIB本語学・日本文学演習IV B国語学国文学(演習)日本の歴史と文化 \\ \hline
        心理学の入門科目は何がありますか？ & 基礎演習：社会心理学心理学概論系共通科目(心理学)(講義Kc)（知覚・認知心理学）心理学概論 & 基礎演習：社会心理学心理学概論系共通科目(心理学)(講義Ｉ)心理学概論 \\ \hline
        ビジネス関連の授業は何がありますか？ & 商法（総則・商行為）ビジネスエシックス起業と事業創造 商法（総則・商行為） & 商法（総則・商行為）演習(4回生医療ビジネス・イノベーション概論Business English-E3 \\ \hline
        生物学の実験を含む授業は何ですか？ & 生物学実習Ｉ ［基礎コース］細胞と分子の基礎生物学実験個体の基礎生物学実験生物先端科学実験及び実験法II & 生物学実習Ｉ ［基礎コース］個体の基礎生物学実験生物物理学分子生物学実験及び実験法 \\ \hline
        環境問題について学べる授業を探しています。 & 環境学国際環境政治学環境学環境法 & 環境学Human-environmental Interactions-E2 環境法基礎地球科学B （地球システムと環境） \\ \hline
        環境問題について学べる授業は何ですか？ & 環境学環境学環境学 環境と法 & 環境学環境法大気・地球環境工学演習(4回生) \\ \hline
    \end{tabular}
    \caption{data3 の質問応答表}
\end{table}



\section{単語出現頻度に基づく検索手法の実験}

\subsection{BM25 （Best Matching 25）とは}
BM25は、情報検索において文書の関連性を評価する上で広く用いられる手法である。文書内の単語の出現頻度（tf）と、その単語がコーパス内のどのくらいの文書に含まれているかを示す逆文書頻度（idf）を組み合わせることで、各単語の重要度を数値化する。この計算式には、k1とbという調整可能なパラメータが含まれており、特にk1は、tfの重み付けを調整する役割を持つ。k1の値が大きいほど、tfの影響が大きくなり、単語の出現頻度が高い文書ほど高いスコアが得られやすくなる。今回はそのパラメータを調節しどの程度が良いか結論づける。

\subsection{実験結果・考察}
具体的である1つ目の質問、「電気回路を学べる科目はなんですか」を参考にすると、\( k = 5 \) で全く関係のない科目が消えるため、\( k = 5 \) がこのパラメータとしては適切なのではないかと思われる。BM25はキーワードが合致していないとなかなか適合せず、抽象的な質問には答えることができないようで、シラバスRAGの検索手法でそのままBM25を用いるのは、実用としては難しいと思った。
そのため、キーワードを抜き出し検索したり、生成aiでシラバスに含まれそうなキーワードを増幅したりしながら、抽象的なクエリに対して検索をもっと工夫する必要があると思った。


\begin{table}[h!]
    \centering
    \begin{tabular}{|p{4cm}|p{4cm}|p{4cm}|p{4cm}|p{4cm}|}
        \hline
        質問/応答 & \( k=1 \) & \( k=3 \) & \( k=5 \) & \( k=10 \) \\ \hline
        稀な文書の重みが強すぎそうである & フランス語の順位がだんだん下がってきた & 一個目の質問でフランス語が消えた & & \\ \hline
        電気回路を学べる科目はなんですか？ & \begin{tabular}[c]{@{}l@{}} 電気電子回路入門 \\ フランス語IIＢ F2155 \\ 応用生命科学入門I \\ 電子回路 \\ ビルマ（ミャンマー）語I（初級）(語学) \end{tabular} & \begin{tabular}[c]{@{}l@{}} 電気電子回路入門 \\ 電気・電子工学 \\ 電気電子工学基礎実験 \\ フランス語IIＢ F2155 \\ 電気機器基礎論 \end{tabular} & \begin{tabular}[c]{@{}l@{}} 電気電子回路入門 \\ 電気・電子工学 \\ 電気電子工学基礎実験 \\ 電気回路基礎論 \\ 電気電子回路 \end{tabular} & \begin{tabular}[c]{@{}l@{}} 電気電子回路入門 \\ 電気・電子工学 \\ 電気電子工学基礎実験 \\ 電気電子回路 \\ 電気回路基礎論 \end{tabular} \\ \hline
        機械学習を学べる授業は何ですか？ & \begin{tabular}[c]{@{}l@{}} 学術連携共同：数理科学の研究フロンティア \\ 英語リーディング ER27(技能領域) \\ アカデミックリーディング \\ 英語リーディング ER26(技能領域) \\ アカデミックリーディング \\ ヒューマンインタフェースの心理と生理 \\ フランス語IIＢ \end{tabular} & \begin{tabular}[c]{@{}l@{}} フランス語IIＢ F2155 \\ 英語リーディング ER27(技能領域) \\ アカデミックリーディング \\ 行動生態学入門 \\ ヒューマンインタフェースの心理と生理 \\ ILASセミナー ：障害とは何か \end{tabular} & \begin{tabular}[c]{@{}l@{}} フランス語IIＢ F2155 \\ 行動生態学入門 \\ 英語リーディング ER27(技能領域) アカデミックリーディング \\ 地震学 \\ ヒューマンインタフェースの心理と生理 \end{tabular} & \begin{tabular}[c]{@{}l@{}} 行動生態学入門 \\ フランス語IIＢ F2155 \\ 欧米経済史 \\ 地震学 \\ 欧米経済史 \end{tabular} \\ \hline
    \end{tabular}
    \caption{質問応答表の結果}
\end{table}
